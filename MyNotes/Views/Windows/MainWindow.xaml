<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="MyNotes.Views.Windows.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="using:MyNotes.Views.Windows"
        xmlns:models="using:MyNotes.Models"
        xmlns:animatedvisuals="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
        xmlns:templates="using:MyNotes.Templates"
        Title="MyNotes">

  <Window.SystemBackdrop>
    <MicaBackdrop />
  </Window.SystemBackdrop>

  <UserControl x:Name="MainWindow_RootControl">
    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition />
      </Grid.RowDefinitions>

      <Grid x:Name="MainWindow_TitleBarGrid"
            Height="48">
        <Grid.ColumnDefinitions>
          <ColumnDefinition x:Name="LeftPaddingColumn"
                            Width="0" />
          <ColumnDefinition x:Name="BackButtonColumn"
                            Width="Auto" />
          <ColumnDefinition x:Name="PaneToggleButtonColumn"
                            Width="Auto" />
          <ColumnDefinition x:Name="IconColumn"
                            Width="Auto" />
          <ColumnDefinition x:Name="TitleColumn"
                            Width="Auto" />
          <ColumnDefinition x:Name="LeftDragColumn"
                            Width="*" />
          <ColumnDefinition x:Name="SearchColumn"
                            Width="4*"
                            MinWidth="220" />
          <ColumnDefinition x:Name="RightDragColumn"
                            Width="*" />
          <ColumnDefinition x:Name="RightPaddingColumn"
                            Width="0" />
        </Grid.ColumnDefinitions>

        <templates:AnimatedIconButton x:Name="MainWindow_BackButton"
                                      x:Uid="MainWindow_BackButton"
                                      Grid.Column="1"
                                      Content="&#xE72B;"
                                      Visibility="{x:Bind MainWindow_NavigationFrame.CanGoBack, Mode=OneWay}"
                                      Click="MainWindow_BackButton_Click">
          <templates:AnimatedIconButton.AnimatedIconSource>
            <animatedvisuals:AnimatedBackVisualSource />
          </templates:AnimatedIconButton.AnimatedIconSource>
        </templates:AnimatedIconButton>

        <templates:AnimatedIconButton x:Name="MainWindow_PaneToggleButton"
                                      x:Uid="MainWindow_PaneToggleButton"
                                      Grid.Column="2"
                                      Content="&#xE700;"
                                      Click="MainWindow_PaneToggleButton_Click">
          <templates:AnimatedIconButton.AnimatedIconSource>
            <animatedvisuals:AnimatedGlobalNavigationButtonVisualSource />
          </templates:AnimatedIconButton.AnimatedIconSource>
        </templates:AnimatedIconButton>

        <ImageIcon Grid.Column="3"
                   Source="/Assets/AppIcon_128.ico"
                   Width="16"
                   Height="16"
                   Margin="8,0" />

        <TextBlock x:Name="MainWindow_TitleTextBlock"
                   Grid.Column="4"
                   Text="MyNotes"
                   Padding="8,0"
                   VerticalAlignment="Center"
                   Foreground="{ThemeResource WindowCaptionForeground}" />

        <AutoSuggestBox x:Name="MainWindow_SearchAutoSuggestBox"
                        x:Uid="MainWindow_SearchAutoSuggestBox"
                        Grid.Column="6"
                        QueryIcon="Find"
                        VerticalAlignment="Center"
                        MaxWidth="330" />
      </Grid>

      <NavigationView x:Name="MainWindow_NavigationView"
                      Grid.Row="1"
                      IsBackButtonVisible="Collapsed"
                      IsPaneToggleButtonVisible="False"
                      IsSettingsVisible="False"
                      MenuItemsSource="{x:Bind ViewModel.MenuItems.View}"
                      FooterMenuItemsSource="{x:Bind ViewModel.FooterMenuItems}"
                      SelectedItem="{x:Bind ViewModel.MenuItems.View[0]}"
                      SelectionChanged="MainWindow_NavigationView_SelectionChanged"
                      SizeChanged="MainWindow_NavigationView_SizeChanged"
                      AllowDrop="True">
        <NavigationView.Resources>
          <SolidColorBrush x:Key="NavigationViewContentBackground"
                           Color="{ThemeResource ControlFillColorTransparent}" />
        </NavigationView.Resources>

        <NavigationView.MenuItemTemplateSelector>
          <local:MainWindowNavigationViewDataTemplateSelector>
            <local:MainWindowNavigationViewDataTemplateSelector.NavigationCoreNodeTemplate>
              <DataTemplate x:DataType="models:NavigationCoreNode">
                <NavigationViewItem Content="{x:Bind Title}"
                                    Icon="{x:Bind Icon}" />
              </DataTemplate>
            </local:MainWindowNavigationViewDataTemplateSelector.NavigationCoreNodeTemplate>

            <local:MainWindowNavigationViewDataTemplateSelector.NavigationSeparatorTemplate>
              <DataTemplate x:DataType="models:NavigationSeparator">
                <NavigationViewItemSeparator />
              </DataTemplate>
            </local:MainWindowNavigationViewDataTemplateSelector.NavigationSeparatorTemplate>

            <local:MainWindowNavigationViewDataTemplateSelector.NavigationUserCompositeNodeTemplate>
              <DataTemplate x:DataType="models:NavigationUserCompositeNode">
                <NavigationViewItem Content="{x:Bind Title}"
                                    MenuItemsSource="{x:Bind ChildNodes}">
                  <NavigationViewItem.Icon>
                    <IconSourceElement IconSource="{x:Bind Icon, Mode=OneWay}" />
                  </NavigationViewItem.Icon>

                  <NavigationViewItem.ContextFlyout>
                    <MenuFlyout Placement="BottomEdgeAlignedLeft">
                      <MenuFlyoutItem x:Uid="MainWindow_NavigationUserCompositeNode_AddListMenuFlyoutItem"
                                      Icon="Add" />
                      <MenuFlyoutItem x:Uid="MainWindow_NavigationUserCompositeNode_AddGroupMenuFlyoutItem"
                                      Icon="Add" />
                      <MenuFlyoutSeparator />
                      <MenuFlyoutItem x:Uid="MainWindow_NavigationUserCompositeNode_DeleteMenuFlyoutItem"
                                      Icon="Delete" />
                    </MenuFlyout>
                  </NavigationViewItem.ContextFlyout>
                </NavigationViewItem>
              </DataTemplate>
            </local:MainWindowNavigationViewDataTemplateSelector.NavigationUserCompositeNodeTemplate>

            <local:MainWindowNavigationViewDataTemplateSelector.NavigationUserLeafNodeTemplate>
              <DataTemplate x:DataType="models:NavigationUserLeafNode">
                <NavigationViewItem Content="{x:Bind Title}">
                  <NavigationViewItem.Icon>
                    <IconSourceElement IconSource="{x:Bind Icon, Mode=OneWay}" />
                  </NavigationViewItem.Icon>

                  <NavigationViewItem.ContextFlyout>
                    <MenuFlyout>
                      <MenuFlyoutItem x:Uid="MainWindow_NavigationUserLeafNode_AddListMenuFlyoutItem"
                                      Icon="Add" />
                      <MenuFlyoutItem x:Uid="MainWindow_NavigationUserLeafNode_AddGroupMenuFlyoutItem"
                                      Icon="Add" />
                      <MenuFlyoutSeparator />
                      <MenuFlyoutItem x:Uid="MainWindow_NavigationUserLeafNode_DeleteMenuFlyoutItem"
                                      Icon="Delete" />
                    </MenuFlyout>
                  </NavigationViewItem.ContextFlyout>
                </NavigationViewItem>
              </DataTemplate>
            </local:MainWindowNavigationViewDataTemplateSelector.NavigationUserLeafNodeTemplate>
          </local:MainWindowNavigationViewDataTemplateSelector>
        </NavigationView.MenuItemTemplateSelector>

        <NavigationView.PaneFooter>
          <templates:SubtleIconButton x:Name="MainWindow_PaneFooter_EditListsButton"
                                      x:Uid="MainWindow_PaneFooter_EditListsButton"
                                      Margin="3,0"
                                      Icon="Edit">

            <templates:SubtleIconButton.Flyout>
              <MenuFlyout Placement="Top">
                <MenuFlyoutSubItem x:Name="MainWindow_PaneFooter_AddListMunuFlyoutSubItem"
                                   x:Uid="MainWindow_PaneFooter_AddListMunuFlyoutSubItem"
                                   Icon="Add"
                                   MinWidth="200"
                                   Height="40">
                  <MenuFlyoutItem Text="to root"/>
                  <MenuFlyoutItem Text="at selected position" />
                </MenuFlyoutSubItem>
                <MenuFlyoutSubItem x:Name="MainWindow_PaneFooter_AddGroupMunuFlyoutSubItem"
                                   x:Uid="MainWindow_PaneFooter_AddGroupMunuFlyoutSubItem"
                                   Icon="Add"
                                   MinWidth="200"
                                   Height="40">
                  <MenuFlyoutItem Text="to root" />
                  <MenuFlyoutItem Text="at selected position" />
                </MenuFlyoutSubItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutItem x:Name="MainWindow_PaneFooter_MoveListsMenuFlyoutItem"
                                x:Uid="MainWindow_PaneFooter_MoveListsMenuFlyoutItem"
                                Icon="Switch"
                                MinWidth="200"
                                Height="40"
                                Click="MainWindow_PaneFooter_MoveListsMenuFlyoutItem_Click" />
              </MenuFlyout>
            </templates:SubtleIconButton.Flyout>
          </templates:SubtleIconButton>
        </NavigationView.PaneFooter>

        <Frame x:Name="MainWindow_NavigationFrame" />
      </NavigationView>

      <Popup x:Name="MainWindow_MoveListsPopup"
             Grid.Row="1"
             Canvas.ZIndex="12"
             HorizontalAlignment="Left"
             IsLightDismissEnabled="True"
             IsOpen="False">

        <Grid x:Name="MainWindow_MoveListsInnerGrid"
              Width="320"
              VerticalAlignment="Stretch"
              CornerRadius="{ThemeResource ControlCornerRadius}">
          <Grid.RowDefinitions>
            <RowDefinition Height="92" />
            <RowDefinition />
            <RowDefinition Height="92" />
          </Grid.RowDefinitions>
          <Grid Grid.Row="1"
                Padding="4"
                Margin="3,0"
                Background="{ThemeResource ControlSolidFillColorDefault}"
                CornerRadius="4"
                BorderBrush="{ThemeResource ControlStrokeColorDefault}"
                BorderThickness="1"
                Translation="0,0,12">
            <Grid.Shadow>
              <ThemeShadow />
            </Grid.Shadow>

            <Grid.RowDefinitions>
              <RowDefinition />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TreeView ItemsSource="{x:Bind ViewModel.UserNavigations}"
                      SelectionMode="None">
              <TreeView.ItemTemplateSelector>
                <local:MainWindowTreeViewDataTemplateSelector>
                  <local:MainWindowTreeViewDataTemplateSelector.NavigationUserCompositeNodeTemplate>
                    <DataTemplate x:DataType="models:NavigationUserCompositeNode">
                      <TreeViewItem ItemsSource="{x:Bind ChildNodes}"
                                    IsExpanded="True">
                        <Grid>
                          <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition />
                          </Grid.ColumnDefinitions>

                          <Viewbox Grid.Column="0"
                                   Height="16"
                                   Width="16">
                            <IconSourceElement IconSource="{x:Bind Icon}" />
                          </Viewbox>

                          <TextBlock Grid.Column="1"
                                     Text="{x:Bind Title}" />
                        </Grid>
                      </TreeViewItem>
                    </DataTemplate>
                  </local:MainWindowTreeViewDataTemplateSelector.NavigationUserCompositeNodeTemplate>

                  <local:MainWindowTreeViewDataTemplateSelector.NavigationUserLeafNodeTemplate>
                    <DataTemplate x:DataType="models:NavigationUserLeafNode">
                      <TreeViewItem>
                        <Grid>
                          <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition />
                          </Grid.ColumnDefinitions>

                          <Viewbox Grid.Column="0"
                                   Height="16"
                                   Width="16">
                            <IconSourceElement IconSource="{x:Bind Icon}" />
                          </Viewbox>

                          <TextBlock Grid.Column="1"
                                     Text="{x:Bind Title}" />
                        </Grid>
                      </TreeViewItem>
                    </DataTemplate>
                  </local:MainWindowTreeViewDataTemplateSelector.NavigationUserLeafNodeTemplate>
                </local:MainWindowTreeViewDataTemplateSelector>
              </TreeView.ItemTemplateSelector>
            </TreeView>

            <Rectangle Grid.Row="1"
                       Fill="{ThemeResource CardStrokeColorDefault}"
                       Height="1"
                       Margin="0,4"
                       Stretch="UniformToFill" />

            <templates:SubtleIconButton x:Name="MainWindow_MoveListsApplyButton"
                                        x:Uid="MainWindow_MoveListsApplyButton"
                                        Grid.Row="2"
                                        Icon="Accept"
                                        Padding="8"
                                        HorizontalAlignment="Right"
                                        Click="MainWindow_MoveListsApplyButton_Click" />
          </Grid>

        </Grid>
      </Popup>

      <VisualStateManager.VisualStateGroups>
        <VisualStateGroup x:Name="WindowActivationStates">
          <VisualState x:Name="WindowActivated" />
          <VisualState x:Name="WindowDeactivated">
            <VisualState.Setters>
              <Setter Target="MainWindow_BackButton.IsEnabled"
                      Value="False" />
              <Setter Target="MainWindow_PaneToggleButton.IsEnabled"
                      Value="False" />
              <Setter Target="MainWindow_TitleTextBlock.Foreground"
                      Value="{ThemeResource WindowCaptionForegroundDisabled}" />
              <Setter Target="MainWindow_SearchAutoSuggestBox.IsEnabled"
                      Value="False" />
            </VisualState.Setters>
          </VisualState>
        </VisualStateGroup>

        <VisualStateGroup x:Name="MoveListsPopupVisibilityStates">
          <VisualState x:Name="MoveListsPopupCollapsed" />
          <VisualState x:Name="MoveListsPopupVisible">
            <VisualState.Setters>
              <Setter Target="MainWindow_MoveListsPopup.IsOpen"
                      Value="True" />
            </VisualState.Setters>
          </VisualState>
        </VisualStateGroup>
      </VisualStateManager.VisualStateGroups>
    </Grid>
  </UserControl>
</Window>
