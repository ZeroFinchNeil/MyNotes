<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="MyNotes.Views.Navigations.SettingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:MyNotes.Views.Navigations"
      xmlns:models="using:MyNotes.Models"
      xmlns:ui="using:CommunityToolkit.WinUI"
      xmlns:controls="using:CommunityToolkit.WinUI.Controls"
      xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
      xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
      xmlns:helpers="using:MyNotes.Helpers">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="64" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <Border Grid.Row="0"
            Padding="24,12">
      <TextBlock x:Name="SettingsPage_TitleTextBlock"
                 x:Uid="SettingsPage_TitleTextBlock"
                 VerticalAlignment="Center"
                 Style="{StaticResource TitleTextBlockStyle}" />
    </Border>

    <ScrollViewer x:Name="SettingsPage_ScrollViewer"
                  Grid.Row="1"
                  Padding="24,12,24,0">
      <StackPanel Margin="0,0,0,24"
                  Spacing="12">
        <!--#region Appearance -->
        <StackPanel Spacing="4">
          <TextBlock x:Uid="SettingsPage_Appearance_SubTitleTextBlock"
                     Padding="4"
                     Style="{StaticResource BaseTextBlockStyle}" />

          <!-- App Theme -->
          <controls:SettingsCard x:Uid="SettingsPage_Appearance_ThemeSettingsCard">
            <controls:SettingsCard.HeaderIcon>
              <ImageIcon Source="/Assets/Icons/FluentUISystem/PaintBrush16Regular.svg" />
            </controls:SettingsCard.HeaderIcon>
            <ComboBox SelectedIndex="{x:Bind ViewModel.AppTheme, Mode=TwoWay}"
                      MinWidth="160">
              <ComboBoxItem x:Uid="SettingsPage_Appearance_DefaultThemeComboBoxItem"
                            Tag="Default" />
              <ComboBoxItem x:Uid="SettingsPage_Appearance_LightThemeComboBoxItem"
                            Tag="Light" />
              <ComboBoxItem x:Uid="SettingsPage_Appearance_DarkThemeComboBoxItem"
                            Tag="Dark" />
            </ComboBox>
          </controls:SettingsCard>

          <!-- Language -->
          <StackPanel>
            <controls:SettingsCard x:Name="SettingsPage_Appearance_LanguageSettingsCard"
                                   x:Uid="SettingsPage_Appearance_LanguageSettingsCard"
                                   HeaderIcon="{ui:FontIcon Glyph=&#xF2B7;}">
              <ComboBox ItemsSource="{x:Bind ViewModel.AppLanguages}"
                        SelectedItem="{x:Bind ViewModel.AppLanguage, Mode=TwoWay}"
                        MinWidth="160">
                <ComboBox.ItemTemplate>
                  <DataTemplate x:DataType="models:AppLanguage">
                    <StackPanel Orientation="Horizontal"
                                Spacing="6">
                      <TextBlock Text="{x:Bind NativeName}" />
                      <TextBlock Text="{x:Bind FormatLanguageString(DisplayName, NativeName)}"
                                 Style="{StaticResource CaptionTextBlockStyle}"
                                 VerticalAlignment="Center"
                                 Foreground="{ThemeResource TextFillColorSecondary}" />
                    </StackPanel>
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>
            </controls:SettingsCard>
            <InfoBar x:Name="SettingsPage_Appearance_LanguageInfoBar"
                     x:Uid="SettingsPage_Appearance_LanguageInfoBar"
                     IsOpen="True"
                     Severity="Warning"
                     IsClosable="False"
                     Visibility="Collapsed"
                     CornerRadius="0,0,4,4"
                     BorderThickness="1,0,1,1"
                     Canvas.ZIndex="-1">
              <InfoBar.ActionButton>
                <Button x:Name="SettingsPage_Appearance_RelaunchButton"
                        x:Uid="SettingsPage_Appearance_RelaunchButton"
                        HorizontalAlignment="Right"
                        Click="SettingsPage_Appearance_RelaunchButton_Click" />
              </InfoBar.ActionButton>

              <InfoBar.RenderTransform>
                <TranslateTransform x:Name="SettingsPage_Appearance_LanguageInfoBar_TranslateTransform" />
              </InfoBar.RenderTransform>

              <interactivity:Interaction.Behaviors>
                <interactivity:DataTriggerBehavior Binding="{x:Bind ViewModel.IsAppLanguageChanged, Mode=OneWay}"
                                                   Value="False">
                  <interactivity:GoToStateAction StateName="SettingsPage_LanguageSettingsNormalState" />
                </interactivity:DataTriggerBehavior>

                <interactivity:DataTriggerBehavior Binding="{x:Bind ViewModel.IsAppLanguageChanged, Mode=OneWay}"
                                                   Value="True">
                  <interactivity:GoToStateAction StateName="SettingsPage_LanguageSettingsWarningState" />
                </interactivity:DataTriggerBehavior>
              </interactivity:Interaction.Behaviors>
            </InfoBar>
          </StackPanel>
        </StackPanel>
        <!--#endregion-->

        <!--#region General -->
        <StackPanel Spacing="4">
          <TextBlock x:Uid="SettingsPage_General_SubTitleTextBlock"
                     Padding="4"
                     Style="{ThemeResource BaseTextBlockStyle}" />

          <!-- Startup -->
          <StackPanel>
            <controls:SettingsCard x:Name="SettingsPage_General_StartupSettingsCard"
                                   x:Uid="SettingsPage_General_StartupSettingsCard"
                                   HeaderIcon="{ui:FontIcon Glyph=&#xE7B5;}">
              <ToggleSwitch x:Name="SettingsPage_General_StartupToggleSwitch"
                            Toggled="SettingsPage_General_StartupToggleSwitch_Toggled" />
            </controls:SettingsCard>
            <InfoBar x:Name="SettingsPage_General_StartupInfoBar"
                     x:Uid="SettingsPage_General_StartupInfoBar"
                     IsOpen="True"
                     Severity="Warning"
                     IsClosable="False"
                     Visibility="Collapsed"
                     CornerRadius="0,0,4,4"
                     BorderThickness="1,0,1,1"
                     Canvas.ZIndex="-1">
              <InfoBar.ActionButton>
                <Button x:Name="SettingsPage_General_AppStartupButton"
                        x:Uid="SettingsPage_General_AppStartupButton"
                        HorizontalAlignment="Right"
                        Click="SettingsPage_General_AppStartupButton_Click" />
              </InfoBar.ActionButton>

              <InfoBar.RenderTransform>
                <TranslateTransform x:Name="SettingsPage_General_StartupInfoBar_TranslateTransform" />
              </InfoBar.RenderTransform>
            </InfoBar>
          </StackPanel>

          <!-- Initial Page -->
          <controls:SettingsExpander x:Uid="SettingsPage_General_InitialPageSettingsExpander"
                                     Header="Initial page"
                                     Description="Initial page"
                                     HeaderIcon="{ui:FontIcon Glyph=&#xE72A;}"
                                     IsExpanded="{x:Bind ViewModel.InitialPageType.Equals(3), Mode=OneWay}">
            <ComboBox SelectedIndex="{x:Bind ViewModel.InitialPageType, Mode=TwoWay}"
                      MinWidth="160">
              <ComboBoxItem x:Uid="SettingsPage_General_HomePageComboBoxItem"
                            Content="Home page" />
              <ComboBoxItem x:Uid="SettingsPage_General_BookmarksPageComboBoxItem"
                            Content="Bookmarks page" />
              <ComboBoxItem x:Uid="SettingsPage_General_LastOpenedPageComboBoxItem"
                            Content="Last opened page" />
              <ComboBoxItem x:Uid="SettingsPage_General_SpecificPageComboBoxItem"
                            Content="Specific page" />
            </ComboBox>

            <controls:SettingsExpander.Items>
              <controls:SettingsCard>
                <controls:SettingsCard.Header>
                  <StackPanel Orientation="Horizontal"
                              Spacing="8">
                    <TextBlock Text="Composite 1"
                               Style="{StaticResource BodyLargeTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondary}" />
                    <TextBlock Text=">"
                               Style="{StaticResource BodyLargeTextBlockStyle}"
                               Foreground="{ThemeResource TextFillColorSecondary}" />
                    <TextBlock Text="{x:Bind ViewModel.InitialPageId, Mode=OneWay}"
                               Style="{StaticResource BodyLargeTextBlockStyle}" />
                  </StackPanel>
                </controls:SettingsCard.Header>
              </controls:SettingsCard>
              <controls:SettingsCard Header="Select a specific page."
                                     HeaderIcon="Add"
                                     IsEnabled="{x:Bind ViewModel.InitialPageType.Equals(3), Mode=OneWay}">
                <Button Content="Select" />
              </controls:SettingsCard>
            </controls:SettingsExpander.Items>
          </controls:SettingsExpander>
        </StackPanel>
        <!--#endregion-->

        <!--#region Note -->
        <StackPanel Spacing="4">
          <TextBlock x:Uid="SettingsPage_Note_SubTitleTextBlock"
                     Padding="4"
                     Style="{ThemeResource BaseTextBlockStyle}" />
          <!-- Default Note Background -->
          <controls:SettingsCard x:Uid="SettingsPage_Note_BackgroundSettingsCard"
                                 HeaderIcon="{ui:FontIcon Glyph=&#xE790;}">
            <SplitButton>
              <Border Width="24"
                      Height="24"
                      CornerRadius="{ThemeResource ControlCornerRadius}" 
                      Background="{x:Bind helpers:ColorHelper.ColorToBrush(ViewModel.NoteBackground), Mode=OneWay}"/>
              <SplitButton.Flyout>
                <Flyout Placement="BottomEdgeAlignedRight"
                        ShouldConstrainToRootBounds="False">
                  <StackPanel>
                    <ColorPicker IsAlphaEnabled="True"
                                 IsMoreButtonVisible="True"
                                 Color="{x:Bind ViewModel.NoteBackground, Mode=TwoWay}"/>
                  </StackPanel>
                </Flyout>
              </SplitButton.Flyout>
            </SplitButton>
          </controls:SettingsCard>

          <!-- Default Note Backdrop -->
          <controls:SettingsCard x:Uid="SettingsPage_Note_BackdropSettingsCard"
                                 HeaderIcon="{ui:FontIcon Glyph=&#xF4A5;}">
            <ComboBox SelectedIndex="{x:Bind ViewModel.NoteBackdrop, Mode=TwoWay}"
                      MinWidth="160">
              <ComboBoxItem x:Uid="SettingsPage_Note_BackdropNoneComboBoxItem" />
              <ComboBoxItem x:Uid="SettingsPage_Note_BackdropAcrylicComboBoxItem" />
              <ComboBoxItem x:Uid="SettingsPage_Note_BackdropMicaComboBoxItem" />
            </ComboBox>
          </controls:SettingsCard>

          <!-- Default Note Size -->
          <controls:SettingsExpander x:Uid="SettingsPage_Note_SizeSettingsExpander"
                                     HeaderIcon="{ui:FontIcon Glyph=&#xE9A6;}">
            <TextBlock Text="{x:Bind helpers:StringHelper.SizeToString(ViewModel.NoteWidth, ViewModel.NoteHeight), Mode=OneWay}"
                       Foreground="{ThemeResource TextFillColorSecondary}" />
            <controls:SettingsExpander.Items>
              <controls:SettingsCard x:Uid="SettingsPage_Note_WidthSettingsCard">
                <controls:SettingsCard.HeaderIcon>
                  <ImageIcon Source="/Assets/Icons/FluentUISystem/ArrowBidirectionalLeftRight16Regular.svg" />
                </controls:SettingsCard.HeaderIcon>
                <NumberBox SpinButtonPlacementMode="Inline"
                           Value="{x:Bind ViewModel.NoteWidth, Mode=TwoWay}"
                           Minimum="300"
                           Maximum="1000"
                           SmallChange="10"
                           Width="160" />
              </controls:SettingsCard>
              <controls:SettingsCard x:Uid="SettingsPage_Note_HeightSettingsCard">
                <controls:SettingsCard.HeaderIcon>
                  <ImageIcon Source="/Assets/Icons/FluentUISystem/ArrowBidirectionalUpDown16Regular.svg" />
                </controls:SettingsCard.HeaderIcon>
                <NumberBox SpinButtonPlacementMode="Inline"
                           Value="{x:Bind ViewModel.NoteHeight, Mode=TwoWay}"
                           Minimum="200"
                           Maximum="1000"
                           SmallChange="10"
                           Width="160" />
              </controls:SettingsCard>
            </controls:SettingsExpander.Items>
          </controls:SettingsExpander>
        </StackPanel>
        <!--#endregion-->

        <!--#region List -->
        <StackPanel Spacing="4">
          <TextBlock x:Uid="SettingsPage_List_SubTitleTextBlock"
                     Padding="4"
                     Style="{ThemeResource BaseTextBlockStyle}" />

          <!-- Show Note Count SettingsCard -->
          <controls:SettingsCard x:Uid="SettingsPage_List_ShowNoteCountSettingsCard">
            <controls:SettingsCard.HeaderIcon>
              <ImageIcon Source="/Assets/Icons/FluentUISystem/Document10016Regular.svg" />
            </controls:SettingsCard.HeaderIcon>
            <ToggleSwitch IsOn="{x:Bind ViewModel.ShowNoteCount, Mode=TwoWay}" />
          </controls:SettingsCard>
        </StackPanel>
        <!--#endregion -->

        <!--#region Widget -->
        <StackPanel Spacing="4">
          <TextBlock x:Uid="SettingsPage_Widget_SubTitleTextBlock"
                     Text="Widget"
                     Padding="4"
                     Style="{ThemeResource BaseTextBlockStyle}" />

          <!-- Show Note Count SettingsCard -->
          <controls:SettingsCard Header="Widget Settings">
            <Button Style="{StaticResource SubtleButtonStyle}">
              <SymbolIcon Symbol="Forward" />
            </Button>
          </controls:SettingsCard>
        </StackPanel>
        <!--#endregion -->

        <!--#region About -->
        <StackPanel Spacing="4">
          <TextBlock x:Uid="SettingsPage_About_SubTitleTextBlock"
                     Padding="4"
                     Style="{ThemeResource BaseTextBlockStyle}" />
          <controls:SettingsExpander Header="MyNotes"
                                     Description="Â© 2025. All rights reserved.">
            <controls:SettingsExpander.HeaderIcon>
              <ImageIcon Source="/Assets/AppIcon.ico" />
            </controls:SettingsExpander.HeaderIcon>
            
            <TextBlock Text="v1.0.0" />
            <controls:SettingsExpander.Items>
              <controls:SettingsCard Header="About" />
            </controls:SettingsExpander.Items>
          </controls:SettingsExpander>
        </StackPanel>
        <!--#endregion-->

      </StackPanel>
    </ScrollViewer>

    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup>
        <VisualState x:Name="SettingsPage_LanguageSettingsNormalState" />
        <VisualState x:Name="SettingsPage_LanguageSettingsWarningState">
          <VisualState.Setters>
            <Setter Target="SettingsPage_Appearance_LanguageSettingsCard.CornerRadius"
                    Value="4,4,0,0" />
            <Setter Target="SettingsPage_Appearance_LanguageInfoBar.Visibility"
                    Value="Visible" />
          </VisualState.Setters>
          <Storyboard>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SettingsPage_Appearance_LanguageInfoBar"
                                           Storyboard.TargetProperty="Opacity">
              <DiscreteDoubleKeyFrame KeyTime="0:0:0"
                                      Value="0" />
              <SplineDoubleKeyFrame KeyTime="0:0:0.167"
                                    KeySpline="0.30,0.30 0,0.95"
                                    Value="1" />
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SettingsPage_Appearance_LanguageInfoBar_TranslateTransform"
                                           Storyboard.TargetProperty="Y">
              <DiscreteDoubleKeyFrame KeyTime="0:0:0"
                                      Value="-32" />
              <SplineDoubleKeyFrame KeyTime="0:0:0.167"
                                    KeySpline="0.30,0.30 0,0.95"
                                    Value="0" />
            </DoubleAnimationUsingKeyFrames>
          </Storyboard>
        </VisualState>
      </VisualStateGroup>

      <VisualStateGroup>
        <VisualState x:Name="SettingsPage_StartupSettingsNormalState" />
        <VisualState x:Name="SettingsPage_StartupSettingsWarningState">
          <VisualState.Setters>
            <Setter Target="SettingsPage_General_StartupSettingsCard.CornerRadius"
                    Value="4,4,0,0" />
            <Setter Target="SettingsPage_General_StartupInfoBar.Visibility"
                    Value="Visible" />
          </VisualState.Setters>
          <Storyboard>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SettingsPage_General_StartupInfoBar"
                                           Storyboard.TargetProperty="Opacity">
              <DiscreteDoubleKeyFrame KeyTime="0:0:0"
                                      Value="0" />
              <SplineDoubleKeyFrame KeyTime="0:0:0.167"
                                    KeySpline="0.30,0.30 0,0.95"
                                    Value="1" />
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SettingsPage_General_StartupInfoBar_TranslateTransform"
                                           Storyboard.TargetProperty="Y">
              <DiscreteDoubleKeyFrame KeyTime="0:0:0"
                                      Value="-32" />
              <SplineDoubleKeyFrame KeyTime="0:0:0.167"
                                    KeySpline="0.30,0.30 0,0.95"
                                    Value="0" />
            </DoubleAnimationUsingKeyFrames>
          </Storyboard>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>
  </Grid>
</Page>
